# variables
variable       lammps_ani_root getenv LAMMPS_ANI_ROOT
variable       newton_pair     index  off
variable       data_file       index  water-0.8nm.data
variable       ani_model_file  index  ${lammps_ani_root}/tests/ani2x.pt
variable       ani_device      index  cuda
variable       ani_num_models  index  1
variable       ani_aev         index  cuaev
variable       ani_neighbor    index  full
variable       ani_precision   index  single
variable       dump_file       index  dump.yaml
variable       change_box      index  'all boundary p p p'
variable       steps           index  4

# Intialization
units          real
atom_style     atomic

neighbor       2.0 bin
# always rebuild neighbor list every 2 steps
neigh_modify   every 2 delay 0 check no
newton         ${newton_pair} off

# Atom Definition
read_data      ${data_file}
change_box     ${change_box}

# TODO remove 5.1 cutoff
# pair_style ani 5.1 model_file device num_models ani_aev ani_neighbor
# 0. model_file               = path to the model file
# 1. device                   = cuda/cpu
# 2. num_models (Optional)    = number of models to use, default as -1 to use all models
# 3. ani_aev (Optional)       = cuaev/pyaev, default as cuaev
# 4. ani_neighbor (Optional)  = full/half, default as full
# 5. ani_precision (Optional) = single/double, default as single

pair_style     ani 5.1 ${ani_model_file} ${ani_device} ${ani_num_models} ${ani_aev} ${ani_neighbor} ${ani_precision}
pair_coeff     * *

# timestep (0.1 fs)
# velocity       all create 0.0 123456
fix            1 all nve
timestep       0.1


# compute pressure (with thermo contribution)
compute        press all pressure thermo_temp 
compute        press_pair all pressure NULL pair

# dump
dump           yaml_dump all yaml 1 dump.yaml id type x y z fx fy fz  # c_atomicenergies
# TODO: add thermo yes once the issue is fixed: https://github.com/lammps/lammps/issues/3799
# so we could read the thermo info directly from the dump file
dump_modify    yaml_dump time yes units yes format float "% 10.10e"
thermo_style   custom step pe ke etotal temp press vol density c_press[*] c_press_pair[*]
thermo_modify  line yaml format none
thermo         1

# Run the simulation: first run (5 ps)
run            ${steps}

# write final state of simulation
# write_data    water.final
